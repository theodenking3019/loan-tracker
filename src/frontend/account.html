<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Account</title>
    <link rel="stylesheet" href="styles/styles.css">
    <style>
        /* You may want to move these styles to styles.css for consistency */
        #userInfo {
            position: absolute;
            top: 10px;
            left: 10px;
        }

        #logoutBtn {
            position: absolute;
            top: 10px;
            right: 10px;
        }

        #borrowForm {
            text-align: center;
            margin-top: 100px;
            font-size: large;
        }
    </style>
</head>

<body>

    <!-- Logout button -->
    <div id="logoutBtn">
        <button onclick="location.href='/logout'">Logout</button>
    </div>

    <!-- User Info -->
    <div id="userInfo">
        <p>Email: <span id="userEmail"></span></p>
        <p>Ethereum Address: <span id="userEthAddress"></span></p>
    </div>

    <!-- Loan Amount Input -->
    <form id="borrowForm" action="/borrow" method="post">
        <div>
            <label for="amount">Enter your desired loan amount in USD: </label>
            <input type="number" id="amount" name="amount" min="1" max="10000" required>
        </div>
        <div>
            <button type="submit">Request Loan</button>
        </div>
    </div>

    <script>
        // Load username and wallet address
        window.onload = async function() {
            try {
                const response = await fetch('/account-data');
                if (!response.ok) throw new Error('Failed to fetch user data');
                
                const data = await response.json();
    
                document.getElementById('userEmail').textContent = data.userEmail;
                document.getElementById('userEthAddress').textContent = data.userEthereumAddress;
            } catch (error) {
                console.error(error);
                // Potentially redirect to login page or show error
                window.location.href = '/login';
            }
        }

        // Handle submission of borrowing data
        const borrowForm = document.getElementById('borrowForm');

        borrowForm.addEventListener('submit', async (event) => {
            event.preventDefault();

            const amount = borrowForm.amount.value;

            const response = await fetch(borrowForm.action, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    amount
                })
            })

        const responseData = await response.json();

        // Handle response here (show success message, redirect, etc.)
        if (responseData.success) {
        // Redirect to the home page
            console.log('Successfully saved loan amount');
        } else if (responseData.error) {
            // Handle error, like showing an error message to the user
            console.log('Error in saving loan amount');
        }  
    });

    </script>

</body>

</html>
